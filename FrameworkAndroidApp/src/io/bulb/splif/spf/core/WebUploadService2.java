package io.bulb.splif.spf.core;

import java.io.ByteArrayOutputStream;

import java.util.ArrayList;

import org.apache.http.NameValuePair;
import org.apache.http.client.HttpClient;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.message.BasicNameValuePair;

import android.graphics.Bitmap;
import android.graphics.BitmapFactory;

import android.os.Handler;

public class WebUploadService2 extends SPFThread {

	private String uploadstring;

	public WebUploadService2(String mip, String mkey, String mpath,
			Handler mhandler, String muploadstring) {
		super(mip, mkey, mpath, mhandler);
		
		uploadstring = muploadstring;
	
	}

	public void run() {
		// Perform thread commands...
		if (uploadstring.equals("picture taken")) {

			Bitmap bitmap = BitmapFactory.decodeFile("/sdcard/photo.jpg");
			ByteArrayOutputStream output = new ByteArrayOutputStream();

			bitmap.compress(Bitmap.CompressFormat.JPEG, 100, output);

			byte[] bytearray = output.toByteArray();

			String base = io.bulb.splif.misc.Base64.encodeBytes(bytearray);

			ArrayList<NameValuePair> nameValuePairs = new ArrayList<NameValuePair>();

			nameValuePairs.add(new BasicNameValuePair("picture", base));
			try {

				HttpClient httpclient = new DefaultHttpClient();
				String http = "http://";

				String url = "/pictureupload.php";
				String uri = http.concat(ip);
				String postto1 = uri.concat(path);
				String postto = postto1.concat(url);
				HttpPost httppost = new HttpPost(postto);
				httppost.setEntity(new UrlEncodedFormEntity(nameValuePairs));
				httpclient.execute(httppost);
				// HttpEntity entity = response.getEntity();
				// InputStream input = entity.getContent();
			} catch (Exception e) {

				e.printStackTrace();

			}

		} else {

			ArrayList<NameValuePair> nameValuePairs = new ArrayList<NameValuePair>();
			nameValuePairs.add(new BasicNameValuePair("text", uploadstring));
			try {
				HttpClient httpclient = new DefaultHttpClient();
				String http = "http://";
				String url = "/putfuncuploader.php";
				String uri = http.concat(ip);
				String postto1 = uri.concat(path);
				String postto = postto1.concat(url);
				HttpPost httppost = new HttpPost(postto);
				httppost.setEntity(new UrlEncodedFormEntity(nameValuePairs));
				httpclient.execute(httppost);
				// HttpEntity entity = response.getEntity();
				// InputStream input = entity.getContent();
			} catch (Exception e) {

				e.printStackTrace();

			}
		}

	}

}
