package io.bulb.splif.spf.core;

import java.util.ArrayList;

import android.app.Service;
import android.content.Intent;
import android.os.IBinder;
import android.telephony.SmsManager;
import android.util.Log;

public class CommandHandler extends Service {
	/**
	 * TAG for LogCat
	 */
	private static final String TAG = "SPF";
	@Override
	public void onCreate() {
		// TODO Auto-generated method stub

	}

	@Override
	public IBinder onBind(Intent intent) {
		// TODO Auto-generated method stub
		return null;
	}

	public void sendMSG(String body) {
		String send = "SEND";

		if (body.length() >= 12) {

			String checkfunction = body.substring(8, 12);
			if (checkfunction.equals(send)) {
				String aString[] = body.split(" ");
				if (aString.length >= 4) {
					String number = aString[2];
					String message = aString[3];
					for (int j = 4; j < aString.length; j++) {
						message += " ";
						message += aString[j];
					}
					/*
					 * Intent intent2 = new Intent(getApplicationContext(),
					 * SMSService.class); intent2.putExtra("number", number);
					 * intent2.putExtra("message", message); Context context =
					 * getApplicationContext(); context.startService(intent2);
					 */
					sendSMS(number, message);
					Log.i(TAG, "Sending Message : " + number + " "+ message);
				}

			}

		}
	}

	public void sendSMS(String number, String message) {
		Log.d(TAG,"sendSMS");
		try {

			SmsManager sm = SmsManager.getDefault();
			if (message.length() > 160) {

				ArrayList<String> messageparts = sm.divideMessage(message);
				sm.sendMultipartTextMessage(number, null, messageparts, null,
						null);
			} else {

				sm.sendTextMessage(number, null, message, null, null);
			}
			
			Log.i(TAG, "SMS Sent : " + number + " "+ message);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
}
